<!doctype html>
<html lang="cz">
    {{template "head"}}
    <body>
        {{template "menu" .Login}}
        <main class="container">
            {{if eq .Murinoha "form"}}
                 <div id="loginContainer" class="w-25 mx-auto">
                    <div class="p-4  border rounded-2">
                    <form method="post" action="/registration">
                    
                        <h2 class="h5 fw-normal">Zaregistrujte se přes...</h2>
                        <div><a href="/login-facebook"><img class="img-fluid" src="static/img/facebook-login-icon.png" /></a></div>
                        <div class="mt-1"><a href="/login-google"><img class="img-fluid" src="static/img/google-login-icon.png" /></a></div>
                        <h2 class="h5 fw-normal mt-4">.. anebo klasicky emailem.</h2>
                        <label for="inputName" class="visually-hidden">Jméno</label>
                        <input id="inputName" class="form-control mt-1" placeholder="Jméno" name="firstname" value="" required>
                        <label for="inputSurname" class="visually-hidden">Příjmení</label>
                        <input id="inputSurname" class="form-control mt-1" placeholder="Příjmení" name="lastname" value="" required>
                        <select name="gender" class="form-select mt-1" required>
                            <option value="" selected disabled>Pohlaví</option>
                            <option value="Z">Žena</option>
                            <option value="M">Muž</option>
                        </select>
                        <select name="birdthyear" class="form-select mt-1"  required>
                            <option value="" selected disabled>Ročník</option>
                            {{range $val := .Years}}
                                <option value="{{$val}}">{{$val}}</option> 
                            {{end}}
                        </select>  
                        <label for="inputEmail" class="visually-hidden">Email address</label>
                        <input type="email" id="inputEmail" name="email" class="form-control mt-1" v-bind:class="{'is-invalid':userExists}"  aria-describedby="userExistsValidation" placeholder="Email"  v-model="email" v-on:keyup="checkUserExists()" v-on:past="checkUserExists()" required>
                        <div id="userExistsValidation" class="invalid-feedback">${hlaska}</div>
                        <label for="inputPassword" class="visually-hidden">Password</label>
                        <input type="password" id="inputPassword" name="password" class="form-control mt-1" placeholder="Heslo" required>
                        <button class="w-100 btn btn-lg btn-success mt-1" type="submit" v-bind:disabled="userExists ? true : null">Zaregistrovat se</button>
                    </form>
                    </div>
                </div>
            {{else if eq .Murinoha "registration_success"}}
                <div class="alert alert-primary text-center" role="alert">Na email <a href="mailto:{{.Email}}">{{.Email}}</a> byla zaslána zpráva s autorizačním kódem, registrace bude dokončená po úspěšné autorizaci.</div>
            {{else if eq .Murinoha "email_exists_already"}}
                <div class="alert alert-danger text-center" role="alert">Registrace pod emailem {{.Email}} už existuje, <a href="/registration">zaregistrujte se znovu</a> a použijte jiný email</div>
            {{else if eq .Murinoha "email_password_exists_already"}}
                <div class="alert alert-danger text-center" role="alert">Registrace pod emailem {{.Email}} už existuje a je použit způsob přihlašování pomocí hesla, tudíž není možno použít přihlášení pomocí třetí strany</div>
            {{end}}
            {{template "footer"}}
        </main>
         
         
         <script>




     new Vue({
     
      delimiters: ['${', '}'],
      el: '#loginContainer',
      data : {
        email: "",
        hlaska: "",
        userExists: false
      },
      methods: {
        checkUserExists(){
        
          try{
            (async () => {
                const response = await  axios.get('/checkuserexists',{params: {email:this.email}});
                //alert()
                  if(response.data == true){
                    this.userExists = true
                    this.hlaska = "Tento email již je použit a podruhé se použít nedá."
                  }
                  else{
                  this.userExists = false
                  }

            })();
          }catch(err){
            console.log(err);
        }
      }


  }
})


  </script>
    </body>
</html>
